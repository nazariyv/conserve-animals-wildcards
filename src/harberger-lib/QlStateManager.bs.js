// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE

import * as Curry from "bs-platform/lib/es6/curry.js";
import * as React from "react";
import * as Belt_Array from "bs-platform/lib/es6/belt_Array.js";
import * as Belt_Option from "bs-platform/lib/es6/belt_Option.js";
import * as Caml_option from "bs-platform/lib/es6/caml_option.js";
import * as ApolloClient from "@wildcards/reason-apollo/src/ApolloClient.bs.js";
import * as ReasonApollo from "@wildcards/reason-apollo/src/ReasonApollo.bs.js";
import * as ApolloConsumer from "@wildcards/reason-apollo/src/ApolloConsumer.bs.js";
import * as QlHooks$WildCards from "./QlHooks.bs.js";
import * as ApolloHooks$ReasonApolloHooks from "@wildcards/reason-apollo-hooks/src/ApolloHooks.bs.js";

var context = React.createContext(false);

var make = context.Provider;

function makeProps(value, children, param) {
  return {
          value: value,
          children: children
        };
}

var RootContext = {
  context: context,
  make: make,
  makeProps: makeProps
};

function useIsInitialized(param) {
  return React.useContext(context);
}

function QlStateManager(Props) {
  var children = Props.children;
  var result = QlHooks$WildCards.useStateChangeSubscriptionData(undefined);
  var initialDataLoad = QlHooks$WildCards.useInitialDataLoad(undefined);
  var hasLoadedInitialData = initialDataLoad !== undefined;
  return React.createElement(make, makeProps(hasLoadedInitialData, null, undefined), Belt_Option.mapWithDefault(result, null, (function (result) {
                    return React.createElement(ApolloConsumer.make, {
                                children: (function (client) {
                                    var stateChanges = result.stateChanges[0];
                                    var changedWildcards = stateChanges.wildcardChanges;
                                    var changedPatrons = stateChanges.patronChanges;
                                    Belt_Array.map(changedWildcards, (function (wildcard) {
                                            var query = QlHooks$WildCards.SubWildcardQuery.make(wildcard.id, undefined);
                                            var readQueryOptions = ApolloHooks$ReasonApolloHooks.toQueryObj(query);
                                            ApolloClient.ReadQuery({
                                                  query: QlHooks$WildCards.SubWildcardQuery.query,
                                                  parse: QlHooks$WildCards.SubWildcardQuery.parse
                                                });
                                            var SubWildcardQueryWriteQuery = ApolloClient.WriteQuery({
                                                  query: QlHooks$WildCards.SubWildcardQuery.query,
                                                  parse: QlHooks$WildCards.SubWildcardQuery.parse
                                                });
                                            var cachedResponse;
                                            try {
                                              cachedResponse = client.readQuery(readQueryOptions);
                                            }
                                            catch (exn){
                                              return ;
                                            }
                                            if (cachedResponse == null) {
                                              return ;
                                            }
                                            var setupWildcardForCache = ((wildcardData, cachedWildcard) =>{
                             return {
                               wildcard: {
                                 typename: "Wildcard",
                                 ...wildcardData,
                                 ...cachedWildcard.wildcard
                               }
                             }
                           });
                                            return Curry._4(SubWildcardQueryWriteQuery.make, client, Caml_option.some(query.variables), setupWildcardForCache(wildcard, cachedResponse), undefined);
                                          }));
                                    return Belt_Array.map(changedPatrons, (function (patron) {
                                                  var patronQuery = QlHooks$WildCards.LoadPatron.make(patron.id, undefined);
                                                  var readQueryOptions = ApolloHooks$ReasonApolloHooks.toQueryObj(patronQuery);
                                                  ApolloClient.ReadQuery({
                                                        query: QlHooks$WildCards.LoadPatron.query,
                                                        parse: QlHooks$WildCards.LoadPatron.parse
                                                      });
                                                  var LoadPatronWriteQuery = ApolloClient.WriteQuery({
                                                        query: QlHooks$WildCards.LoadPatron.query,
                                                        parse: QlHooks$WildCards.LoadPatron.parse
                                                      });
                                                  var exit = 0;
                                                  var cachedResponse;
                                                  try {
                                                    cachedResponse = client.readQuery(readQueryOptions);
                                                    exit = 1;
                                                  }
                                                  catch (exn){
                                                    
                                                  }
                                                  if (exit === 1 && !(cachedResponse == null)) {
                                                    console.log("Cached Patron", cachedResponse, patron);
                                                    var setupPatronForCache = ((patronData, cachedPatron) =>{
                             return {
                               patron: {
                                 typename: "Patron",
                                 ...patronData,
                                 ...cachedPatron.patron
                               }
                             }
                           });
                                                    Curry._4(LoadPatronWriteQuery.make, client, Caml_option.some(patronQuery.variables), setupPatronForCache(patron, cachedResponse), undefined);
                                                  }
                                                  var queryNew = QlHooks$WildCards.LoadPatronNewNoDecode.make(patron.id, undefined);
                                                  var LoadPatronNewQuery = ReasonApollo.CreateQuery({
                                                        query: QlHooks$WildCards.LoadPatronNewNoDecode.query,
                                                        parse: QlHooks$WildCards.LoadPatronNewNoDecode.parse
                                                      });
                                                  ApolloClient.WriteQuery({
                                                        query: QlHooks$WildCards.LoadPatronNew.query,
                                                        parse: QlHooks$WildCards.LoadPatronNew.parse
                                                      });
                                                  return React.createElement(LoadPatronNewQuery.make, {
                                                              variables: queryNew.variables,
                                                              fetchPolicy: "network-only",
                                                              children: (function (param) {
                                                                  var result = param.result;
                                                                  if (typeof result === "number") {
                                                                    return null;
                                                                  }
                                                                  if (!result.tag) {
                                                                    return null;
                                                                  }
                                                                  var filterByNameQuery = QlHooks$WildCards.LoadPatronNew.make(patron.id, undefined);
                                                                  var readQueryOptions = ApolloHooks$ReasonApolloHooks.toQueryObj(filterByNameQuery);
                                                                  ApolloClient.ReadQuery({
                                                                        query: QlHooks$WildCards.LoadPatronNew.query,
                                                                        parse: QlHooks$WildCards.LoadPatronNew.parse
                                                                      });
                                                                  var LoadPatronNewWriteQuery = ApolloClient.WriteQuery({
                                                                        query: QlHooks$WildCards.LoadPatronNew.query,
                                                                        parse: QlHooks$WildCards.LoadPatronNew.parse
                                                                      });
                                                                  var exit = 0;
                                                                  var cachedResponse;
                                                                  try {
                                                                    cachedResponse = client.readQuery(readQueryOptions);
                                                                    exit = 1;
                                                                  }
                                                                  catch (exn){
                                                                    
                                                                  }
                                                                  if (exit === 1 && !(cachedResponse == null)) {
                                                                    var setupNewPatronForCache = ((newPatronData, previousPatron) =>{
                           let newPatron = newPatronData.newPatron;
                           let prevPatron = previousPatron.newPatron;
                           return {
                             newPatron: {
                               typename: "NewPatron",
                               ...prevPatron,
                               ...newPatron,
                             }
                           }
                         });
                                                                    Curry._4(LoadPatronNewWriteQuery.make, client, Caml_option.some(filterByNameQuery.variables), setupNewPatronForCache(result[0], cachedResponse), undefined);
                                                                  }
                                                                  return null;
                                                                })
                                                            });
                                                }));
                                  })
                              });
                  })), children);
}

var make$1 = QlStateManager;

export {
  RootContext ,
  useIsInitialized ,
  make$1 as make,
  
}
/* context Not a pure module */
